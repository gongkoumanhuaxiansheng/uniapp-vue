# 微信小程序云数据库集合创建指南

## 🚨 问题说明

错误 `errCode: -502005 database collection not exists` 表明需要在云数据库中创建 `orders` 集合。

## 📋 解决步骤

### 1. 打开云数据库控制台
1. 在微信开发者工具中点击"云开发"按钮
2. 选择"数据库"选项卡
3. 确保已选择正确的云环境

### 2. 创建orders集合
1. 点击"+"按钮（创建集合）
2. 集合名称输入：`orders`
3. 点击"确定"创建

### 3. 配置集合权限（推荐）
为了数据安全，建议配置适当的权限：

```json
{
  "read": true,
  "write": "doc._openid == auth.openid"
}
```

这样配置表示：
- 所有人可以读取（管理员查看订单）
- 只有创建者可以写入（用户只能创建自己的订单）

### 4. 验证集合创建
创建完成后，你应该能在数据库控制台看到：
- 集合名称：`orders`
- 记录数：0（新创建的空集合）
- 权限：已配置

## 🔄 测试步骤

1. **重新测试订单提交**：
   - 选择图片
   - 填写地址
   - 点击"生成订单"

2. **预期结果**：
   - 图片上传成功
   - 订单数据保存成功
   - 显示"订单提交成功，等待审核"

3. **验证数据**：
   - 在云数据库控制台查看orders集合
   - 应该能看到新创建的订单记录

## 📊 orders集合数据结构

创建的订单记录包含以下字段：

```json
{
  "_id": "自动生成的订单ID",
  "_openid": "用户openid",
  "address": "收货地址",
  "images": ["图片FileID数组"],
  "status": 0,
  "createTime": "创建时间"
}
```

**字段说明**：
- `_id`: 系统自动生成的唯一标识符
- `_openid`: 用户的微信openid（系统自动添加）
- `address`: 用户填写的收货地址
- `images`: 上传图片的云存储FileID数组
- `status`: 订单状态（0=待审核，1=已通过，2=已拒绝）
- `createTime`: 订单创建时间

## ⚠️ 注意事项

1. **集合命名**：必须使用 `orders`（小写，复数形式）
2. **权限设置**：生产环境请务必配置适当的读写权限
3. **数据备份**：重要数据建议定期备份
4. **索引优化**：记录较多时可考虑添加索引提升查询性能

## 🔍 常见问题

### Q: 创建集合后仍然报错？
A: 请检查：
- 集合名称是否为 `orders`（注意大小写）
- 云环境是否选择正确
- 是否在正确的云环境中创建集合

### Q: 数据保存成功但查询不到？
A: 可能的原因：
- 权限配置问题
- 查询条件不正确
- 网络延迟导致的数据同步问题

### Q: 如何删除测试数据？
A: 在云数据库控制台中：
- 选择orders集合
- 找到要删除的记录
- 点击删除按钮